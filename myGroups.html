<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Groups</title>
    <style>
        /* Style for the buttons container */
        #group-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Style for each button */
        .group-button {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f0f0f0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Style for the money at the top right corner */
        .total-money {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>My Groups</h1>
    
    <!-- Total money across all groups -->
    <div class="total-money" id="total-money">
        Total Money: $0
    </div>

    <!-- Container for dynamically created group buttons -->
    <div id="group-buttons-container"></div>

    <script>
        // Retrieve the current user's email and group list
        const currentUser = localStorage.getItem("currentUser");
        const users = localStorage.getItem("users");

        if (!currentUser) {
            alert("You must be logged in to view your groups!");
            window.location.href = 'index.html'; // Redirect if no current user
        }

        // Parse user data
        const parsedUserData = JSON.parse(users);
        const email = parsedUserData[currentUser].email;
        const groupList = JSON.parse(localStorage.getItem(email)) || [];

        const groupButtonsContainer = document.getElementById("group-buttons-container");
        const totalMoneyContainer = document.getElementById("total-money");

        // Variable to track total money
        let totalMoney = 0;

        // Ensure no duplicate buttons are created
        const existingButtons = new Set();

        groupList.forEach(groupCode => {
            // If the button for this group code already exists, skip it
            if (existingButtons.has(groupCode)) return;

            // Mark this group code as processed
            existingButtons.add(groupCode);

            // Retrieve the group data from userGroups in localStorage
            const userGroups = JSON.parse(localStorage.getItem("userGroups"));
            if (userGroups && userGroups[groupCode]) {
                const groupData = userGroups[groupCode];
                const groupName = groupData[0][1];  // Group name from the first member in the group

                // Calculate the total money in the group
                const groupTotalMoney = groupData.reduce((sum, userInfo) => sum + userInfo[2], 0);
                totalMoney += groupTotalMoney;

                // Create a button for each group
                const button = document.createElement("button");
                button.textContent = `${groupName} - $${groupTotalMoney}`;
                button.classList.add("group-button");

                // Add event listener to the button to navigate to the group page
                button.addEventListener("click", () => {
                    // Redirect to the group page, passing the groupCode as a query parameter
                    window.location.href = `groupPage.html?groupCode=${groupCode}`;
                });

                // Append the button to the container
                groupButtonsContainer.appendChild(button);
            }
        });

        // Update the total money displayed
        totalMoneyContainer.textContent = `Total Money: $${totalMoney}`;
    </script>
</body>
</html>
